
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Mission Elevations - mwptools</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mission-elevations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="mwptools" class="md-header__button md-logo" aria-label="mwptools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mwptools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mission Elevations
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="mwptools" class="md-nav__button md-logo" aria-label="mwptools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    mwptools
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running/" class="md-nav__link">
        Running mwp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ui/" class="md-nav__link">
        User interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dock/" class="md-nav__link">
        Dock Concepts and Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mission-editor/" class="md-nav__link">
        Mission Editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gcs-features/" class="md-nav__link">
        Ground Control Station Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../replay-tools/" class="md-nav__link">
        Replay Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc-ui-elements/" class="md-nav__link">
        Miscellaneous Ui Elements
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Mission Elevations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mission Elevations
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#video-tutorial-ui-integration" class="md-nav__link">
    Video Tutorial &amp; UI integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-output" class="md-nav__link">
    Sample output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-mission-file" class="md-nav__link">
    Creating a new mission file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-version" class="md-nav__link">
    Go version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ruby-version" class="md-nav__link">
    Ruby version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    Caveats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datums" class="md-nav__link">
    Datums
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#so-whos-right" class="md-nav__link">
    So who's right?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-help-and-options" class="md-nav__link">
    Command line help and options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    Configuration File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    Usage Examples
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kmz-planned-in-google-earth" class="md-nav__link">
    KMZ planned in Google Earth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conversion-tools" class="md-nav__link">
    Conversion tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#climb-and-dive-angle-report" class="md-nav__link">
    Climb and Dive Angle Report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finally" class="md-nav__link">
    Finally ....
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-multi-procotol/" class="md-nav__link">
        "Serial" device support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-Configuration/" class="md-nav__link">
        mwp Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-safehomes-editor/" class="md-nav__link">
        mwp and inav safehome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-Radar-View/" class="md-nav__link">
        Radar View
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp_video_player/" class="md-nav__link">
        Playing Video in mwp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Fly-By-Home-waypoints-%28inav-4-new-feature%29/" class="md-nav__link">
        Fly By Home Waypoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Black-Ops/" class="md-nav__link">
        Anonymous Maps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Build and Install
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Build and Install" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Build and Install
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Building-with-meson-and-ninja/" class="md-nav__link">
        Building mwp (Generic)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-in-Windows-11---WSL-G/" class="md-nav__link">
        Windows 11 / WSL-G
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miscellaneous" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-Power-and-screen-management/" class="md-nav__link">
        Power and screen management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../inav-4.0-multi-missions/" class="md-nav__link">
        INAV 4.0 Multi-Mission Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt---bulletgcss-telemetry/" class="md-nav__link">
        BulletGCSS Telemetry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Support-for-inav-3.0-WP-features/" class="md-nav__link">
        mwp and inav 3.0 Mission Updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Replaying-Ardupilot-logs/" class="md-nav__link">
        Ardupilot log replay
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Flite-text-to-speech/" class="md-nav__link">
        Flite text to speech
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp-Dbus-API/" class="md-nav__link">
        DBus API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mwp_support/" class="md-nav__link">
        Support Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../licence-misc-info/" class="md-nav__link">
        Licence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#video-tutorial-ui-integration" class="md-nav__link">
    Video Tutorial &amp; UI integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-output" class="md-nav__link">
    Sample output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-mission-file" class="md-nav__link">
    Creating a new mission file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-version" class="md-nav__link">
    Go version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ruby-version" class="md-nav__link">
    Ruby version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    Caveats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datums" class="md-nav__link">
    Datums
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#so-whos-right" class="md-nav__link">
    So who's right?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-help-and-options" class="md-nav__link">
    Command line help and options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    Configuration File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    Usage Examples
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kmz-planned-in-google-earth" class="md-nav__link">
    KMZ planned in Google Earth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conversion-tools" class="md-nav__link">
    Conversion tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#climb-and-dive-angle-report" class="md-nav__link">
    Climb and Dive Angle Report
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finally" class="md-nav__link">
    Finally ....
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="mission-elevations">Mission Elevations<a class="headerlink" href="#mission-elevations" title="Permanent link">#</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>Prior to inav 3.0, mission altitudes are relative to the HOME (arming) location, which is not part of a mission definition. As a result, the pilot has to be ensure by some other means that the mission will clear any raised elevations on the mission path. For inav 3.0, missions may be either <a href="../Support-for-inav-3.0-WP-features/">relative to home or absolute</a> (above a <a href="#datums">datum, see below</a>).</p>
<p><strong>mwp</strong> includes a <code>mwp-plot-elevations</code> tool that performs mission and terrain analysis.
Prior to 2021-05-03, this was provided by a ruby script in <code>mwptools/samples</code>; since 2021-05-03 there is a Go program (in <code>mwptools/mwp-plot-elevations</code>) which is an enhanced version, and supports <a href="../Support-for-inav-3.0-WP-features/">inav 3.0 absolute altitude</a> missions. If you're running an older version of <strong>mwp</strong>, or you haven't installed the Go compiler, you can use the older, less functional ruby version, but the Go version is recommended as:</p>
<ul>
<li>It supports inav 3.0 absolute altitude waypoints</li>
<li>It can update LAND waypoints to offset the difference between the home ground elevation and the LAND WP ground elevation.</li>
<li>It's much faster</li>
<li>Its usage is compatible with the deprecated ruby version.</li>
<li>Bug fixes and improvements</li>
</ul>
<p>Both the ruby application and the Go application are platform independent and can be used without <a href="https://github.com/stronnag/mwptools">mwp</a> for mission terrain analysis.</p>
<div class="admonition note">
<p class="admonition-title">Obsolescence Note</p>
<p>Prior to 2021-05, the ruby version was installed as <code>mwp-plot-elevations.rb</code>; now it's installed as plain <code>mwp-plot-elevations</code> in order that the superior Go version is a drop in replacement.</p>
</div>
<p><code>mwp-plot-elevations</code> can rewrite the mission file with new elevations to provide a specified ground clearance.</p>
<h2 id="video-tutorial-ui-integration">Video Tutorial &amp; UI integration<a class="headerlink" href="#video-tutorial-ui-integration" title="Permanent link">#</a></h2>
<p>From of 2018-12-06, <code>mwp-plot-elevations</code> is integrated into the <code>mwp</code> application.</p>
<p><img alt="mwp integration" src="../images/mwp-ta.png" /></p>
<p>There is a <a href="https://www.youtube.com/watch?v=oE3t5Asqhio">video tutorial</a>.</p>
<div class="admonition note">
<p class="admonition-title">Obsolescence Note</p>
<p>The video uses the older ruby application, but that doesn't really affect <em>basic</em> functionality.</p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/oE3t5Asqhio" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h2 id="sample-output">Sample output<a class="headerlink" href="#sample-output" title="Permanent link">#</a></h2>
<p>Given the mission shown below:
<img alt="Test Mission" src="../images/west-field-mission.png" />
and knowing that the land rises to the north and west, we can check that we do indeed have adequate clearance with the planned route and elevations:</p>
<p><div class="highlight"><pre><span></span><code># for decimal &#39;.&#39; locales
$ mwp-plot-elevations -- home 50.9104826,-1.5350745 --plotfile profile.svg  west_field.mission
# for decimal &#39;,&#39; locales
$ mwp-plot-elevations --home &quot;50,9104826 -1,5350745&quot; --plotfile profile.svg  west_field.mission
</code></pre></div>
where:</p>
<ul>
<li><code>west_field.mission</code> is the MW-XML mission file (via <a href="https://github.com/stronnag/mwptools">mwp</a>, ezgui, mission planner for inav or <a href="https://github.com/stronnag/impload">impload</a>)</li>
<li>the <code>--home lat,lon</code> option defines the home position (which may also be set by the environment variable <code>MWP_HOME</code>), the command line having preference.</li>
<li>The graphical output is <code>profile.svg</code>, via the <code>--plotfile</code> option.</li>
</ul>
<p>The result from this command is an SVG file, which can be displayed with common image tools (<code>eog</code>, ImageMagick <code>display</code> et al). It can also be converted to a raster image using e.g. <code>rsvg-convert</code>); a sample is shown below:</p>
<p><img alt="Mission Elevation" src="../images/mission-elev.svg" /></p>
<p>The red line represents the planned mission altitudes (which are defined relative to the estimated home location), and the green area represents the terrain. As we can see, we clear the hill (and other terrain), but cannot guarantee that we have LOS to lowest point of the mission, or that we're clear of the trees.</p>
<p>We can also specify a "clearance" option, in the image below this was set to 16m. Where the blue line is above the red line, one should review that the mission elevations are adequate.</p>
<p><img alt="Mission Clearance" src="../images/wf-margin.svg" /></p>
<h2 id="creating-a-new-mission-file">Creating a new mission file<a class="headerlink" href="#creating-a-new-mission-file" title="Permanent link">#</a></h2>
<p>It is also possible (see command line options below) to write out a new mission that takes into account the clearance (<code>margin</code> parameter). If we then plot this new mission file, we can see that we are at least <code>margin</code> (in this example 16m) distance clear of the terrain.</p>
<p><img alt="Mission Clearance" src="../images/modified-mission.svg" /></p>
<p>Note that the original mission elevations are still taken into account. We can also ignore these, so we end up the absolute clearance distance above the terrain.</p>
<p><div class="highlight"><pre><span></span><code>$ mwp-plot-elevations nm_west_field.mission --output /tmp/p1.mission --no-mission-alts
</code></pre></div>
<img alt="Absolute Clearance" src="../images/abs.svg" /></p>
<h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">#</a></h2>
<p>The <strong><code>mwp-plot-elevations</code></strong> has <strong>NO</strong> dependency on <a href="https://github.com/stronnag/mwptools">mwp</a> or Linux/FreeBSD, it can just as easily be run on MacOS or even MS Windows. It does however has some dependencies:</p>
<h3 id="go-version">Go version<a class="headerlink" href="#go-version" title="Permanent link">#</a></h3>
<ul>
<li>Go compiler (1.13 or later)</li>
</ul>
<h3 id="ruby-version">Ruby version<a class="headerlink" href="#ruby-version" title="Permanent link">#</a></h3>
<ul>
<li>ruby (2.0 or later)</li>
<li>ruby 'gems' (libraries)</li>
<li>nokogiri</li>
<li>gnuplot</li>
</ul>
<p><code>gnuplot</code> is easily provided (by your distro or from a binary download), and the nokogiri dependency is also easily satisfied by either the distro or Ruby's <code>gem</code> command:</p>
<p><div class="highlight"><pre><span></span><code>$ apt install ruby-nokogiri
### or ###
&gt; gem install nokogiri
## mwp Windows / Cygwin
$ cyg-apt install ruby-nokogiri
</code></pre></div>
Using the package manager is recommended for non-proprietary operating systems.</p>
<p>On all operating systems, the terrain graph is also plotted interactively, regardless of whether the <code>-p</code> (save SVG plot) option has been specified. The following shows the UI on Windows (it's pretty much the same on other OS).</p>
<p><img alt="Interactive UI" src="../images/plot-elevations-windows.png" /></p>
<h2 id="caveats">Caveats<a class="headerlink" href="#caveats" title="Permanent link">#</a></h2>
<ul>
<li>3rd party terrain data is not guaranteed, either as to its absolute accuracy, nor to its coverage.</li>
<li>Terrain data does not take into account other obstacles (trees, buildings, power lines etc).</li>
<li>The tool does not faithfully model the vehicle motion. As multi-rotor and fixed-wing have different climb behaviours, this would be quite complex.</li>
<li>RTH altitude has to specified if you wish to model it, and assumes 'AT LEAST' behaviour.</li>
</ul>
<h2 id="datums">Datums<a class="headerlink" href="#datums" title="Permanent link">#</a></h2>
<p>Digital elevation services can use the WGS84 Ellipsoid or "sea level"; survey maps typically use AMSL (Above Mean Sea Level); GPS can report either or both of WGS Ellipsoid and above MSL (mean sea level). The "sea level" used by Bing Elevations is computed from a magnetic anomaly / gravity database and may not be the same as the AMSL "sea level" used by the survey.  <strong>Caveat User</strong>.</p>
<ul>
<li>mwp currently uses Bing "Sea level" to obtain elevations. The user should apply a suitable margin.</li>
<li><a href="https://github.com/iNavFlight/inav">inav</a> firmware uses the GPS' AMSL value, so <a href="https://github.com/iNavFlight/inav">inav</a> and <a href="https://github.com/stronnag/mwptools">mwp</a> are consistent on this.</li>
<li>The inav configurator uses Bing's Ellipsoid values (by default, it can be changed).</li>
</ul>
<p>Due to the granularity of the AMSL grid used by GPS and the gravity based Bing Sea Level, there may be a significant difference between ASML, "sea level", WGS84 Ellipsoid and Survey heights, for example, for a test point of  54.149461 -4.669315 (summit of South Barrule, Isle of Man):</p>
<ul>
<li>Google Earth : 470m</li>
<li>Ordnance Survey (OS) Map (official survey): 483m</li>
<li>Bing Ellipsoid (Configurator): 526m</li>
<li>Bing "Sea Level" (mwp): 470m</li>
</ul>
<h2 id="so-whos-right">So who's right?<a class="headerlink" href="#so-whos-right" title="Permanent link">#</a></h2>
<p>Many years ago, I took a GPS up South Barrule.</p>
<p><img alt="barrule" src="https://user-images.githubusercontent.com/158229/129704384-a91904b9-becc-435d-9c38-9bc0fa31563d.png" /></p>
<p>It reads 485m, this pretty much agrees with the OS (Survey) height (AMSL). So the real issue is with the DEM available online (either Bing or Google). The 'sealevel" height DEM reports <strong>for this location</strong> is c. 13m below Ordnance Survey AMSL value whilst the WGS84 ellipsoid value is 43m above the OS AMSL value.</p>
<h2 id="command-line-help-and-options">Command line help and options<a class="headerlink" href="#command-line-help-and-options" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>$ mwp-plot-elevations --help
Usage of mwp-plot-elevations [options] missionfile
  -dump
        Dump  internal data,exit
  -home string
        home as DD.dddd,DDD.dddd (default &quot;50.910476,-1.535038&quot;)
  -margin int
        Clearance margin (m) (default 16)
  -no-mission-alts
        Ignore extant mission altitudes
  -no-plot
        No interactive plot
  -output string
        Revised mission file
  -plotfile string
        SVG graph file
  -rth-alt int
        RTH altitude (m) (default 25)
  -upland
        Update landing elevation offset
</code></pre></div>
<p>Note that Go considers <code>-foo</code> and <code>--foo</code> to the equivalent. The ruby script requires the <code>--</code> notation.</p>
<h2 id="configuration-file">Configuration File<a class="headerlink" href="#configuration-file" title="Permanent link">#</a></h2>
<p>As well as specifying options such as home location, clearance margin and RTH altitude on the command line (or as an environment variable), some or all of these options may be set in a configuration file.</p>
<p><code>mwp-plot-elevations</code> looks for options in one of the following (in order) <code>./.elev-plot.rc</code> (i.e. current directory), <code>$HOME/.config/mwp/elev-plot</code>,  and <code>$HOME/.elev-plot.rc</code>. The configuration file is a simple text file containing <code>key=value</code> pairs. Blank lines and lines beginning with <code>#</code> are ignored; the following example illustrates the recognised keys. Note that  <code>$HOME/.config/mwp/elev-plot</code> is the preferred location, as this is also used by <code>mwp</code> to populate its graphical dialogue to launch the analysis tool.</p>
<div class="highlight"><pre><span></span><code># settings for mwp-plot-elevations
margin = 16
home = 50.910476,-1.535038
# for &#39;,&#39; locales
# home = 50,910476 -1,535038
rth-alt=25
# &#39;sanity&#39; is the home -&gt; WP1 distance check; default if not set here is 100m
sanity = 200
</code></pre></div>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code># Interactive plot, using the above configuration file:
$ mwp-plot-elevations nm_west_field.mission

# Interactive plot. save SVG file
$ mwp-plot-elevations --plotfile /tmp/mission.svg nm_west_field.mission

# Interactive plot. save SVG file, rewrite mission file
$ mwp-plot-elevations --plotfile /tmp/mission.svg --output new_west_field.mission nm_west_field.mission

# Interactive plot. save SVG file, rewrite mission file, override clearance margin (20m)
$ mwp-plot-elevationsb --plotfile /tmp/mission.svg --outout new_west_field.mission --margin 20 nm_west_field.mission

# Interactive plot. save SVG file, rewrite mission file,
# override clearance margin (20m), reduce RTH altitude (22m)
$ mwp-plot-elevations --plotfile /tmp/mission.svg --output new_west_field.mission --margin 20 --rth-alt 22 nm_west_field.mission
</code></pre></div>
<p>Another contrived example ... create a mission in Google Earth (tied to ground), save as KMZ, convert to MWXML mission file with <a href="https://github.com/stronnag/impload">impload</a> (0 altitude). Use <code>mwp-plot-elevations.rb</code> to calculate a safe mission.</p>
<h3 id="kmz-planned-in-google-earth">KMZ planned in Google Earth<a class="headerlink" href="#kmz-planned-in-google-earth" title="Permanent link">#</a></h3>
<p><img alt="Google Earth Mission Plan" src="../images/perwick-ge.png" /></p>
<h3 id="conversion-tools">Conversion tools<a class="headerlink" href="#conversion-tools" title="Permanent link">#</a></h3>
<p><div class="highlight"><pre><span></span><code># convert the saved KMZ file to a MWXML mission file
$ impload convert  /tmp/IOM.kmz /tmp/perwick.mission

# Verify the elevations and clearance with plot-elevations.rb
$ mwp-plot-elevations.rb -h  54.068826,-4.735472   -m 40 /tmp/perwick.mission
</code></pre></div>
<img alt="Elevations verified" src="../images/perwick-m0.svg" /></p>
<p>Looks OK (well, apart from the flying through the hill, due to impload's default altitude of 20m).</p>
<p>If we specify that a new mission file be generated (<code>--output</code>), the updated mission is also plotted, and we can see that this clears the hill.</p>
<div class="highlight"><pre><span></span><code>mwp-plot-elevations --home  54.068826,-4.735472 --margin 40 --output /tmp/perwick-ok.mission /tmp/perwick.mission
</code></pre></div>
<p><img alt="Elevations verified" src="../images/perwick-m1.svg" /></p>
<p>It's not yet perfect, we could be more aggressive in reaching just the clearance altitude, but we clear the hill!.</p>
<h2 id="climb-and-dive-angle-report">Climb and Dive Angle Report<a class="headerlink" href="#climb-and-dive-angle-report" title="Permanent link">#</a></h2>
<figure>
<p><img alt="exmaple mission" src="../images/barrule-mission.png" /></p>
<figcaption>Mission used for climb /dive example</figcaption>
</figure>
<p>As of 2021-06, it's also possible to get climb and dive angles for the calculated mission. Before I added the WP12 =&gt; WP7 jump in the mission shown below, it was almost OK; below the desired clearance in a couple of places and just failing to clear the hill at WP15. After adding the JUMP, it hits the terrain pretty conclusively between WP12 and WP7. The modified mission is interesting, as it has to adjust the WPs within the JUMP for the worst case (so the WP7, the second pass is definitive).</p>
<p>The final result:</p>
<p><img alt="jump mission" src="../images/mwp-plot-elevations-jump.png" /></p>
<p>We also get a climb / dive report, currently to STDOUT and <code>$TMP/mwpmission-angles.txt</code> (tab separated for easy analysis).</p>
<div class="highlight"><pre><span></span><code>$ mwp-plot-elevations --margin 25 -no-mission-alts --output /tmp/n.mission \
 --home 54.125205,-4.730322 -rth-alt 40 mwp/missions/IoM/barrule-jump.mission
HOME -  WP1  21.3°  (climb)
 WP1 -  WP2 -13.9°  (dive)
 WP2 -  WP3  16.2°  (climb)
 WP3 -  WP4  -8.1°  (dive)
 WP4 -  WP5  11.4°  (climb)
 WP5 -  WP6   4.9°  (climb)
 WP6 -  WP7  -6.6°  (dive)
 WP7 -  WP8  -8.9°  (dive)
 WP8 -  WP9   1.3°  (climb)
 WP9 - WP10   7.0°  (climb)
WP10 - WP11   4.4°  (climb)
WP11 - WP12 -11.9°  (dive)
WP12 -  WP7   0.3°  (climb)
 WP7 -  WP8  -8.9°  (dive)
 WP8 -  WP9   1.3°  (climb)
 WP9 - WP10   7.0°  (climb)
WP10 - WP11   4.4°  (climb)
WP11 - WP12 -11.9°  (dive)
WP12 - WP14   2.5°  (climb)
WP14 - WP15  -5.2°  (dive)
WP15 -  RTH  -3.6°  (dive)
</code></pre></div>
<p>If you run <strong>mwp-plot-elevations</strong> via <strong>mwp</strong>, the information is presented in a separate window.</p>
<p><img alt="cd-analysist" src="../images/mwp-elev-cd-analysis.png" /></p>
<p><strong>mwp</strong> can also highlight any legs that exceed user-defined (not 0) climb and dive angle limits. However, it's up to you to work out the best solution.</p>
<p><img alt="cd-limits" src="../images/climb-dive-indicators.png" /></p>
<p>The steep hill and valley at the start are just too much here; best to reroute.</p>
<h2 id="finally">Finally ....<a class="headerlink" href="#finally" title="Permanent link">#</a></h2>
<p><img alt="win10 plot" src="../images/mwp-plot-elev-win10.png" /></p>
<p>For Window 10 / Cygwin, you probably need to have the Windows <code>gnuplot</code>, vice the Cygwin version.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../misc-ui-elements/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Miscellaneous Ui Elements" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Miscellaneous Ui Elements
            </div>
          </div>
        </a>
      
      
        
        <a href="../mwp-multi-procotol/" class="md-footer__link md-footer__link--next" aria-label="Next: &#34;Serial&#34; device support" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              "Serial" device support
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>